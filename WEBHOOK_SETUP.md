# üöÄ Telegram Webhook –Ω–∞ Vercel (–ë–ï–°–ü–õ–ê–¢–ù–û!)

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:

- üí∞ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ** (Vercel Hobby –ø–ª–∞–Ω)
- ‚ö° **–ë—ã—Å—Ç—Ä–æ** (—É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ Vercel)
- üîÑ **–ê–≤—Ç–æ–¥–µ–ø–ª–æ–π** –∏–∑ GitHub
- üìä **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ**
- üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ**

**–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞!**

---

## üìã –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢:

### –û–±—ã—á–Ω—ã–π –±–æ—Ç (polling):
```
–ë–æ—Ç ‚Üí –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥ ‚Üí —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram "–µ—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è?"
–ù—É–∂–µ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å–µ—Ä–≤–µ—Ä 24/7
```

### Webhook –±–æ—Ç:
```
Telegram ‚Üí –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –≤–∞—à URL
Vercel ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ‚Üí –æ—Ç–≤–µ—á–∞–µ—Ç
–°–µ—Ä–≤–µ—Ä –ù–ï –Ω—É–∂–µ–Ω!
```

---

## üöÄ –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø:

### –®–∞–≥ 1: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Vercel

–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ:
```
https://laundry-app-one.vercel.app
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ webhook endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
https://laundry-app-one.vercel.app/api/telegram/webhook
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "status": "ok",
  "message": "Telegram webhook is active",
  "bot": "@keiin_dorm_laundry_bot"
}
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook –≤ Telegram

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)**

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
node setup-webhook.js set https://laundry-app-one.vercel.app
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook...
üìç Webhook URL: https://laundry-app-one.vercel.app
‚úÖ Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä**

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
https://api.telegram.org/bot8008452513:AAFFoaZm8PGPHIllv8DG9Oirtmm1Aq-LidY/setWebhook?url=https://laundry-app-one.vercel.app/api/telegram/webhook
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "ok": true,
  "result": true,
  "description": "Webhook was set"
}
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Telegram**
2. **–ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞:** `@keiin_dorm_laundry_bot`
3. **–ù–∞–ø–∏—à–∏—Ç–µ:** `/start`
4. **–î–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –æ—Ç–≤–µ—Ç —Å –≤–∞—à–∏–º Chat ID!** ‚úÖ

–ï—Å–ª–∏ –ø—Ä–∏—à–µ–ª –æ—Ç–≤–µ—Ç - **–í–°–ï –†–ê–ë–û–¢–ê–ï–¢!** üéâ

---

## üîç –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê:

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook:
```bash
node setup-webhook.js info
```

–í—ã–≤–æ–¥:
```
üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ webhook...
‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook:
   URL: https://laundry-app-one.vercel.app/api/telegram/webhook
   Pending updates: 0
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:
```
https://api.telegram.org/bot8008452513:AAFFoaZm8PGPHIllv8DG9Oirtmm1Aq-LidY/getWebhookInfo
```

---

## üêõ TROUBLESHOOTING:

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:**
```bash
node setup-webhook.js info
```

**2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel:**
- –û—Ç–∫—Ä–æ–π—Ç–µ https://vercel.com
- –í–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí Deployments
- –ü–æ—Å–ª–µ–¥–Ω–∏–π deployment ‚Üí Logs
- –ò—â–∏—Ç–µ `üì® Received update`

**3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
https://laundry-app-one.vercel.app/api/telegram/webhook
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `status: "ok"`

### Webhook –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –ù–µ—Ç HTTPS (Vercel –≤—Å–µ–≥–¥–∞ HTTPS ‚úÖ)
- –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å webhook
node setup-webhook.js delete

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–Ω–æ–≤–æ
node setup-webhook.js set https://laundry-app-one.vercel.app
```

### –ü—Ä–∏—Ö–æ–¥—è—Ç —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞–∫–æ–ø–∏–ª–∏—Å—å pending updates

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å webhook —Å –æ—á–∏—Å—Ç–∫–æ–π
curl "https://api.telegram.org/bot8008452513:AAFFoaZm8PGPHIllv8DG9Oirtmm1Aq-LidY/deleteWebhook?drop_pending_updates=true"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–Ω–æ–≤–æ
node setup-webhook.js set https://laundry-app-one.vercel.app
```

---

## üîÑ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–û–î–ê:

–ü—Ä–∏ –∫–∞–∂–¥–æ–º `git push`:
1. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç
2. Webhook –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
3. **–ù–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!**

---

## üí∞ –°–¢–û–ò–ú–û–°–¢–¨:

### Vercel Hobby (—Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω):
- ‚úÖ **–ë–ï–°–ü–õ–ê–¢–ù–û**
- ‚úÖ 100 GB bandwidth/–º–µ—Å—è—Ü
- ‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ serverless —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π

**–≠—Ç–æ–≥–æ —Ö–≤–∞—Ç–∏—Ç –¥–ª—è –¥–µ—Å—è—Ç–∫–æ–≤ —Ç—ã—Å—è—á —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–µ—Å—è—Ü!**

### –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—Å–∏—Ç–µ –ª–∏–º–∏—Ç:
- Vercel Pro: **$20/–º–µ—Å—è—Ü**
- –ù–æ –≤—Ä—è–¥ –ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì:

### Vercel Dashboard:
```
https://vercel.com/your-project/deployments
‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–π deployment
‚Üí Functions
‚Üí /api/telegram/webhook
```

–ó–¥–µ—Å—å –≤–∏–¥–Ω—ã:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û—à–∏–±–∫–∏

### Telegram:
```bash
# –°—Ç–∞—Ç—É—Å webhook
node setup-webhook.js info
```

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

**1. –ü—Ä–æ–≤–µ—Ä–∫–∞ secret token (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

–í `route.ts` –¥–æ–±–∞–≤—å—Ç–µ:
```typescript
const SECRET_TOKEN = process.env.TELEGRAM_SECRET_TOKEN;

export async function POST(request: NextRequest) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
  const token = request.headers.get('x-telegram-bot-api-secret-token');
  if (SECRET_TOKEN && token !== SECRET_TOKEN) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  // ...
}
```

**2. Rate limiting:**

Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç DDoS.

**3. –¢–æ–∫–µ–Ω –±–æ—Ç–∞:**

–ù–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –≤ –ø—É–±–ª–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!
(–°–µ–π—á–∞—Å –æ–Ω –≤ –∫–æ–¥–µ, –Ω–æ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ OK)

---

## üÜö –°–†–ê–í–ù–ï–ù–ò–ï: Webhook vs Polling

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Webhook (Vercel) | Polling (Railway) |
|----------|------------------|-------------------|
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (500—á) |
| **–°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞** | ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ | üê¢ 1-2 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∞ |
| **–ù–∞–≥—Ä—É–∑–∫–∞** | ‚úÖ –¢–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö | ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê –°—Ä–µ–¥–Ω–µ | ‚≠ê –õ–µ–≥–∫–æ |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–æ | ‚≠ê‚≠ê‚≠ê –•–æ—Ä–æ—à–æ |

**–í—ã–≤–æ–¥:** Webhook –ª—É—á—à–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω!

---

## ‚ú® –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:

### 1. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã:

–í `route.ts`:
```typescript
else if (text === '/queue') {
  // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –æ—á–µ—Ä–µ–¥—å
}
else if (text === '/status') {
  // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –º–∞—à–∏–Ω–∫–∏
}
```

### 2. Inline –∫–Ω–æ–ø–∫–∏:

```typescript
await sendMessage(chatId, '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', {
  reply_markup: {
    inline_keyboard: [[
      { text: 'üìã –û—á–µ—Ä–µ–¥—å', callback_data: 'queue' },
      { text: '‚úÖ –í—Å—Ç–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å', callback_data: 'join' }
    ]]
  }
});
```

### 3. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ cron:

–°–æ–∑–¥–∞—Ç—å `/api/cron/reminders.ts` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.

---

## üìù CHECKLIST:

- [x] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ Vercel
- [x] Endpoint `/api/telegram/webhook` —Å–æ–∑–¥–∞–Ω
- [x] Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Telegram
- [ ] **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:** –ù–∞–ø–∏—Å–∞—Ç—å `/start` –±–æ—Ç—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Vercel
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üéâ –ì–û–¢–û–í–û!

**–í–∞—à –±–æ—Ç —Ç–µ–ø–µ—Ä—å:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç 24/7
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ git push

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:**
1. Telegram ‚Üí `@keiin_dorm_laundry_bot`
2. –ù–∞–ø–∏—à–∏—Ç–µ `/start`
3. –ü–æ–ª—É—á–∏—Ç–µ Chat ID
4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéä
