# üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ API endpoint `/api/telegram/link` –æ–±–Ω–æ–≤–ª–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç service_role + –∑–∞—â–∏—Ç–∞)
2. ‚úÖ Vercel –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã:
   - `SUPABASE_SERVICE_ROLE_KEY`
   - `TELEGRAM_WEBHOOK_SECRET`
3. ‚úÖ Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Telegram –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
4. ‚úÖ –ö–æ–¥ –∑–∞–ø—É—à–µ–Ω –Ω–∞ GitHub –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Vercel

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ Telegram –±–æ—Ç–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `TELEGRAM_BOT_CODE_UPDATE.py` –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ - —Ç–∞–º –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥.

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –±–æ—Ç–µ:**

#### –ë—ã–ª–æ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥):
```python
response = requests.post(
    f"{BASE_URL}/api/telegram/link",
    json={
        "student_id": student_id,
        "telegram_chat_id": str(chat_id)
    }
)
```

#### –°—Ç–∞–ª–æ (–Ω–æ–≤—ã–π –∫–æ–¥):
```python
WEBHOOK_SECRET = os.getenv("TELEGRAM_WEBHOOK_SECRET")

response = requests.post(
    f"{BASE_URL}/api/telegram/link",
    headers={
        "Content-Type": "application/json",
        "X-Telegram-Secret": WEBHOOK_SECRET  # ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫
    },
    json={
        "student_id": student_id,
        "telegram_chat_id": str(chat_id)
    }
)
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –±–æ—Ç

**–ï—Å–ª–∏ –±–æ—Ç –Ω–∞ Render:**
1. –û—Ç–∫—Ä—ã—Ç—å Dashboard ‚Üí –í–∞—à –±–æ—Ç
2. Environment ‚Üí Add Environment Variable
3. –î–æ–±–∞–≤–∏—Ç—å:
   ```
   Key: TELEGRAM_WEBHOOK_SECRET
   Value: laundry_webhook_secret_key_2025
   ```

**–ï—Å–ª–∏ –±–æ—Ç –Ω–∞ Railway:**
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç
2. Variables ‚Üí New Variable
3. –î–æ–±–∞–≤–∏—Ç—å:
   ```
   TELEGRAM_WEBHOOK_SECRET=laundry_webhook_secret_key_2025
   ```

**–ï—Å–ª–∏ –±–æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (.env —Ñ–∞–π–ª):**
```bash
TELEGRAM_WEBHOOK_SECRET=laundry_webhook_secret_key_2025
BASE_URL=https://laundryapp-one.vercel.app
```

### 3. Redeploy –±–æ—Ç–∞

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- **Render**: Manual Deploy ‚Üí Deploy latest commit
- **Railway**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—Å—è
- **–õ–æ–∫–∞–ª—å–Ω–æ**: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: https://laundryapp-one.vercel.app
2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**
4. –ù–∞–∂–º–∏—Ç–µ **"–ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram"**
5. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –±–æ—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start YOUR_STUDENT_ID`
6. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å: **"‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –¥–ª—è [–í–∞—à–µ –∏–º—è]"**
7. **–°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏!)

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

**–í –ª–æ–≥–∞—Ö –±–æ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üîî Attempting to link Telegram for student: ...
üì° Response status: 200
‚úÖ Successfully linked Telegram for student: ...
```

**–í –ª–æ–≥–∞—Ö Vercel Functions:**
```
üîî Telegram link request: { student_id: '...', telegram_chat_id: '...' }
üë§ Current student data: { ... }
‚úÖ Telegram linked successfully: { ... }
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 401 (Unauthorized):**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `TELEGRAM_WEBHOOK_SECRET` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ –±–æ—Ç–µ –∏ Vercel
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–ª—è Production environment

## üìÅ –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∞–π–ª—ã

- `TELEGRAM_BOT_CODE_UPDATE.py` - –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥ –¥–ª—è –±–æ—Ç–∞
- `TELEGRAM_BOT_UPDATE.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `DEPLOYMENT_CHECKLIST.md` - —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel Functions
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è Production
5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ redeploy –±–æ—Ç–∞ –∏ Vercel

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤:
- ‚úÖ Telegram –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π API
- ‚úÖ –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
