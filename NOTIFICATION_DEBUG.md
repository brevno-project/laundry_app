# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞–º

## –ü—Ä–æ–±–ª–µ–º–∞
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º –æ —Å—Ç–∏—Ä–∫–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, —Ö–æ—Ç—è –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤–Ω–æ—Å—è—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ Telegram.

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ "–í—ã–¥–∞—Ç—å –∫–ª—é—á" —Å—Ç—É–¥–µ–Ω—Ç—É.

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
```
üì§ [CLIENT] Sending Telegram notification: {
  type: 'key_issued',
  full_name: '–ò–º—è –°—Ç—É–¥–µ–Ω—Ç–∞',
  student_id: 'uuid-—Å—Ç—É–¥–µ–Ω—Ç–∞',
  ...
}
üì• [CLIENT] Telegram notification response: {
  ok: true,
  status: 200,
  result: { success: true }
}
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (Vercel)
–û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard ‚Üí Logs –∏ –Ω–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏ –æ—Ç `/api/telegram/notify`

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```
üì® Telegram notification request: {
  type: 'key_issued',
  full_name: '–ò–º—è –°—Ç—É–¥–µ–Ω—Ç–∞',
  student_id: 'uuid-—Å—Ç—É–¥–µ–Ω—Ç–∞',
  ...
}
üéØ Notification routing: { isStudentOnly: true, isAdminOnly: false }
üë§ Attempting to send notification to student: uuid-—Å—Ç—É–¥–µ–Ω—Ç–∞
üîç getStudentTelegramChatId called with student_id: uuid-—Å—Ç—É–¥–µ–Ω—Ç–∞
üìä Query result: { data: { telegram_chat_id: '123456789', full_name: '–ò–º—è' }, error: null }
‚úÖ Found telegram_chat_id for student: –ò–º—è - chat_id: 123456789
üì§ Sending message to student chat_id: 123456789
üì¨ Student notification result: true
‚úÖ Final notification result: { success: true }
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å –≤ Supabase SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ telegram_chat_id —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
SELECT id, full_name, telegram_chat_id 
FROM students 
WHERE telegram_chat_id IS NOT NULL;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
SELECT id, full_name, telegram_chat_id 
FROM students 
WHERE full_name = '–ò–º—è –°—Ç—É–¥–µ–Ω—Ç–∞';
```

### 4. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: student_id –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º:** –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ `student_id: undefined`
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ `QueueList.tsx` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `item.student_id`

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: telegram_chat_id –ø—É—Å—Ç–æ–π –≤ –±–∞–∑–µ
**–°–∏–º–ø—Ç–æ–º:** –í –ª–æ–≥–∞—Ö `‚ùå No telegram_chat_id found for student`
**–†–µ—à–µ–Ω–∏–µ:** 
1. –°—Ç—É–¥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–∏—Ç—å Telegram —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ API `/api/telegram/link` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TELEGRAM_WEBHOOK_SECRET` –≤ .env

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: Telegram Bot Token –Ω–µ–≤–µ—Ä–Ω—ã–π
**–°–∏–º–ø—Ç–æ–º:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –Ω–æ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `TELEGRAM_BOT_TOKEN` –≤ Vercel Environment Variables

#### –ü—Ä–æ–±–ª–µ–º–∞ 4: Chat ID –Ω–µ–≤–µ—Ä–Ω—ã–π
**–°–∏–º–ø—Ç–æ–º:** Telegram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç chat_id (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ —Å —Ü–∏—Ñ—Ä–∞–º–∏)

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram
1. –ó–∞–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram —á–µ—Ä–µ–∑ –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ `telegram_chat_id` —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è

#### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
1. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã–¥–∞—Ç—å –∫–ª—é—á" —Å—Ç—É–¥–µ–Ω—Ç—É
2. –°–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
3. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Vercel
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∏—à–ª–æ –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

## –ò–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–¥–∞—á–µ –∫–ª—é—á–∞
**–§–∞–π–ª:** `src/components/QueueList.tsx`
```tsx
await sendTelegramNotification({
  type: 'key_issued',
  full_name: item.full_name,
  room: item.room,
  student_id: item.student_id,
});
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–§–∞–π–ª:** `src/types/index.ts`
- `key_issued` - –∫–ª—é—á –≤—ã–¥–∞–Ω —Å—Ç—É–¥–µ–Ω—Ç—É
- `washing_started_by_student` - —Å—Ç—É–¥–µ–Ω—Ç –Ω–∞—á–∞–ª —Å—Ç–∏—Ä–∞—Ç—å
- `washing_finished` - —Å—Ç—É–¥–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª —Å—Ç–∏—Ä–∞—Ç—å
- `return_key_reminder` - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤–µ—Ä–Ω—É—Ç—å –∫–ª—é—á

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–§–∞–π–ª—ã:** 
- `src/lib/telegram.ts` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- `src/app/api/telegram/notify/route.ts` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–¥–∞—Ç—å –∫–ª—é—á —Å—Ç—É–¥–µ–Ω—Ç—É
2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ –ª–æ–≥–∏** –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
3. **–û—Ç–∫—Ä–æ–π—Ç–µ Vercel Logs** –∏ –Ω–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏ –æ—Ç `/api/telegram/notify`
4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –ª–æ–≥–∏**, —á—Ç–æ–±—ã —è –º–æ–≥ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É
